package dev.syntax;

import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.mockito.ArgumentMatchers.*;
import static org.mockito.BDDMockito.given;
import static org.mockito.Mockito.verify;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;

import dev.syntax.data.BookingDAO;
import dev.syntax.data.BookingRequest;
import dev.syntax.service.BookingService;
import dev.syntax.service.MailSender;
import dev.syntax.service.PaymentService;
import dev.syntax.service.RoomService;
@ExtendWith(MockitoExtension.class)
public class Test07 {

  @InjectMocks // 목 객체들을 주입받아서 생성하는 객체
  private BookingService bookingService;
  @Mock // 해당 필드를 목 객체로 주입(Injection)
  private PaymentService paymentServiceMock;
  @Mock
  private RoomService roomServiceMock;
  @Mock
  private BookingDAO bookingDAOMock;
  @Mock
  private MailSender mailSenderMock;


  @Test
  @DisplayName("price가 200이고 guestCount가 3이면 결제에 성공하고 bookingDAO.save를 호출한다")
  void pay_price_200_guestCount_3_success() {
      // Given
      BookingRequest request = BookingRequest.builder()
          .guestCount(3)
          .build();
      PaymentService paymentService = new PaymentService(bookingDAOMock);
      given(bookingDAOMock.save(any()))
          .willReturn("BOOK-1");
      
      // When
      String paymentId = paymentService.pay(request, 200.0);

      // Then
      assertNotNull(paymentId);
      verify(bookingDAOMock).save(eq(request));
  }
}
